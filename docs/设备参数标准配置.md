# Tomatis è®¾å¤‡å‚æ•° - æ ‡å‡†é…ç½®

## ğŸ“‹ è®¾å¤‡å®é™…å‚æ•°ï¼ˆTomatis_D å½•éŸ³ï¼‰

### å½•éŸ³è¯´æ˜
- **æºæ–‡ä»¶**: `Tomatis_D.flac`
- **è¾“å…¥**: `D MNF.flac`ï¼ˆåŸå§‹éŸ³é¢‘ï¼‰
- **é—®é¢˜**: å‰ 16 ç§’æ˜¯å…¶ä»–éŸ³ä¹ï¼Œéœ€è¦è£å‰ª

### è®¾å¤‡å‚æ•°è®¾ç½®

| å‚æ•° | è®¾å¤‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **éŸ³é‡** | 100 | ç³»ç»ŸéŸ³é‡ |
| **é—¨æ§ (Gate)** | 50 | UI æ ‡å°ºå€¼ |
| **å»¶è¿Ÿ/æå‰** | æ—  | æ— å»¶è¿Ÿæ— æå‰ |
| **é€šé“1 (C1)** | +5, -5 | ä½é¢‘ +5dB, é«˜é¢‘ -5dB |
| **é€šé“2 (C2)** | -5, +5 | ä½é¢‘ -5dB, é«˜é¢‘ +5dB |
| **ä¸­å¿ƒé¢‘ç‡** | 1000 Hz | 0dB æ”¯ç‚¹ |
| **å¢ç›Š (å¡åº¦)** | 12 dB/oct | å€¾æ–œé€Ÿåº¦ |
| **å¹³è¡¡** | L:100, R:100 | å·¦å³å‡è¡¡ |
| **ç©ºæ°”ä¼ å¯¼** | 100 | - |
| **éª¨ä¼ å¯¼** | 100 | - |

---

## ğŸ¯ å¯¹åº”çš„è½¯ä»¶å‚æ•°

### åŸºç¡€å‚æ•°ï¼ˆå·²åŒ¹é…ï¼‰
```powershell
--fc 1000           # ä¸­å¿ƒé¢‘ç‡ 1000Hz âœ“
--slope 12          # å¡åº¦ 12 dB/oct âœ“
--c1_low 5          # C1 ä½é¢‘ +5dB âœ“
--c1_high -5        # C1 é«˜é¢‘ -5dB âœ“
--c2_low -5         # C2 ä½é¢‘ -5dB âœ“
--c2_high 5         # C2 é«˜é¢‘ +5dB âœ“
```

### Gate å‚æ•°ï¼ˆéœ€è¦æ ¡å‡†ï¼‰

**è®¾å¤‡**: Gate = 50

**å½“å‰æ˜ å°„**: 
```
T_dBFS = gate_scale * gate_ui + gate_offset
T_dBFS = 1.0 * 50 + (-74.2) = -24.2 dBFS
```

**æ ¡å‡†æ–¹æ³•**:
1. å¯¹æ¯” `Tomatis_D.flac` å’Œ `D_MNF_tomatis_v13.flac`
2. åˆ†æ C1/C2 åˆ‡æ¢æ—¶åˆ»çš„å·®å¼‚
3. è°ƒæ•´ `gate_offset` ä½¿åˆ‡æ¢è¡Œä¸ºä¸€è‡´

### å»¶è¿Ÿå‚æ•°

**è®¾å¤‡**: æ— å»¶è¿Ÿæ— æå‰

**è½¯ä»¶é»˜è®¤**: 
```powershell
--up_delay_ms 250   # C1â†’C2 å»¶è¿Ÿ 250ms
```

**å»ºè®®**: å¦‚æœè®¾å¤‡çœŸçš„æ˜¯"æ— å»¶è¿Ÿ"ï¼Œåº”è¯¥è®¾ç½®ï¼š
```powershell
--up_delay_ms 0     # æ— å»¶è¿Ÿ
```

---

## ğŸ”¬ æ ¡å‡†å·¥ä½œæµç¨‹

### æ­¥éª¤ 1: è£å‰ª Tomatis_D å‰ 16 ç§’

```python
import soundfile as sf

# è¯»å–
x, sr = sf.read("Tomatis_D.flac", dtype='float32')

# è£å‰ªå‰ 16 ç§’
cut_samples = int(16.0 * sr)
x_cut = x[cut_samples:]

# ä¿å­˜
sf.write("Tomatis_D_cut16s.flac", x_cut, sr, subtype='PCM_24')

print(f"åŸå§‹é•¿åº¦: {len(x)} é‡‡æ ·ç‚¹ ({len(x)/sr:.2f} ç§’)")
print(f"è£å‰ªå: {len(x_cut)} é‡‡æ ·ç‚¹ ({len(x_cut)/sr:.2f} ç§’)")
```

### æ­¥éª¤ 2: å¯¹é½å¹¶å¯¹æ¯”

ä½¿ç”¨ç°æœ‰çš„ `analyze_dbfs.py` å¯¹é½ `D MNF.flac` å’Œ `Tomatis_D_cut16s.flac`ï¼Œç”Ÿæˆï¼š
- `dbfs_tomatis_device.csv` - è®¾å¤‡å®é™…è¾“å‡ºçš„ dBFS
- `dbfs_tomatis_device.png` - å¯¹æ¯”å›¾

### æ­¥éª¤ 3: åˆ†æ Gate åˆ‡æ¢ç‚¹

```python
import pandas as pd
import numpy as np

# è¯»å–è®¾å¤‡è¾“å‡ºå’Œè½¯ä»¶è¾“å‡º
df_device = pd.read_csv("dbfs_tomatis_device.csv")
df_software = pd.read_csv("state_v13.csv")

# æ‰¾å‡ºåˆ‡æ¢ç‚¹
def find_switches(df, threshold=3.0):
    df['out_diff'] = df['tomatis_dbfs'].diff().abs()
    switches = df[df['out_diff'] > threshold]
    return switches

device_switches = find_switches(df_device)
print(f"è®¾å¤‡åˆ‡æ¢æ¬¡æ•°: {len(device_switches)}")
print(f"è½¯ä»¶åˆ‡æ¢æ¬¡æ•°: {len(df_software[df_software['state'].diff() != 0])}")
```

### æ­¥éª¤ 4: æ‹Ÿåˆ Gate æ˜ å°„

```python
# å‡è®¾æˆ‘ä»¬æ‰¾åˆ°äº†å¤šä¸ª gate_ui å€¼å’Œå¯¹åº”çš„é˜ˆå€¼
gate_ui_values = [40, 50, 60]
threshold_dbfs = [-20.5, -24.2, -28.0]  # ä»å®æµ‹å¾—å‡º

# çº¿æ€§æ‹Ÿåˆ
from scipy.stats import linregress
slope, intercept, r, p, se = linregress(gate_ui_values, threshold_dbfs)

print(f"gate_scale = {slope:.3f}")
print(f"gate_offset = {intercept:.3f}")
print(f"RÂ² = {r**2:.4f}")
```

---

## ğŸ“Š æ ‡å‡†æµ‹è¯•å‘½ä»¤

### æµ‹è¯• 1: åŒ¹é…è®¾å¤‡å‚æ•°ï¼ˆæ— å»¶è¿Ÿï¼‰

```powershell
python process_tomatis.py `
  -i "D MNF.flac" `
  -o "D_MNF_device_match.flac" `
  --gate_ui 50 `
  --gate_scale 1.0 `
  --gate_offset -74.2 `
  --hyst_db 3 `
  --up_delay_ms 0 `
  --fc 1000 `
  --slope 12 `
  --c1_low 5 --c1_high -5 `
  --c2_low -5 --c2_high 5 `
  --n_fft 4096 --hop 2048 `
  --state_csv "state_device_match.csv"
```

### æµ‹è¯• 2: ä¸åŒ Gate å€¼å¯¹æ¯”

```powershell
# Gate = 40 (æ›´å¤š C2)
python process_tomatis.py -i "D MNF.flac" -o "test_gate40.flac" --gate_ui 40 --gate_offset -74.2 --state_csv "state_gate40.csv"

# Gate = 50 (æ ‡å‡†)
python process_tomatis.py -i "D MNF.flac" -o "test_gate50.flac" --gate_ui 50 --gate_offset -74.2 --state_csv "state_gate50.csv"

# Gate = 60 (æ›´å¤š C1)
python process_tomatis.py -i "D MNF.flac" -o "test_gate60.flac" --gate_ui 60 --gate_offset -74.2 --state_csv "state_gate60.csv"
```

---

## ğŸ¯ é¢„æœŸç»“æœ

å¦‚æœå‚æ•°æ ¡å‡†æ­£ç¡®ï¼Œåº”è¯¥è§‚å¯Ÿåˆ°ï¼š

1. **C1/C2 å æ¯”** æ¥è¿‘è®¾å¤‡å½•éŸ³
2. **åˆ‡æ¢æ—¶åˆ»** ä¸è®¾å¤‡å½•éŸ³ä¸€è‡´
3. **é¢‘è°±ç‰¹å¾** ç›¸ä¼¼

---

## âš™ï¸ å‚æ•°è°ƒæ•´æŒ‡å—

### å¦‚æœ C2 å¤ªå¤šï¼ˆè½¯ä»¶æ¯”è®¾å¤‡æ›´"äº®"ï¼‰
â†’ æé«˜ gate_offsetï¼ˆä¾‹å¦‚ -70 è€Œä¸æ˜¯ -74.2ï¼‰

### å¦‚æœ C2 å¤ªå°‘ï¼ˆè½¯ä»¶æ¯”è®¾å¤‡æ›´"åš"ï¼‰
â†’ é™ä½ gate_offsetï¼ˆä¾‹å¦‚ -78 è€Œä¸æ˜¯ -74.2ï¼‰

### å¦‚æœåˆ‡æ¢å¤ªé¢‘ç¹
â†’ å¢å¤§ hyst_dbï¼ˆä¾‹å¦‚ 6 è€Œä¸æ˜¯ 3ï¼‰

### å¦‚æœåˆ‡æ¢å»¶è¿Ÿä¸å¯¹
â†’ è°ƒæ•´ up_delay_msï¼ˆè®¾å¤‡è¯´"æ— å»¶è¿Ÿ"ï¼Œå»ºè®®è®¾ä¸º 0ï¼‰

---

## ğŸ“ æ ¡å‡†è®°å½•æ¨¡æ¿

```
æ—¥æœŸ: 2026-01-18
è®¾å¤‡: Tomatis ç³»ç»Ÿ
è¾“å…¥: D MNF.flac
è®¾å¤‡è¾“å‡º: Tomatis_D.flac (è£å‰ªå‰ 16s)

æµ‹è¯•å‚æ•°:
- gate_ui: 50
- gate_offset: -74.2
- up_delay_ms: 0

ç»“æœ:
- C1 å æ¯”: ____%
- C2 å æ¯”: ____%
- åˆ‡æ¢æ¬¡æ•°: ____
- ä¸»è§‚è¯„ä»·: ____

è°ƒæ•´å»ºè®®:
- ____
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- [process_tomatis.py](file:///F:/TOMATIS/process_tomatis.py) - ä¸»å¤„ç†å™¨
- [analyze_dbfs.py](file:///F:/TOMATIS/analyze_dbfs.py) - å¯¹é½åˆ†æ
- [TomatisæŠ€æœ¯è¯´æ˜.md](file:///F:/TOMATIS/TomatisæŠ€æœ¯è¯´æ˜.md) - æŠ€æœ¯åŸç†
